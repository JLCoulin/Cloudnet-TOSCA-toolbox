# A.14-01.yaml
tosca_definitions_version: tosca_simple_yaml_1_3
description: VNF FG Model for example_NS
imports:
  - etsi_nfv_sol001_nsd_types.yaml  # all of NSD related TOSCA types as defined in ETSI GSÂ NFVSOL 001
  #- etsi_nfv_example_vnf1.yaml # uri of the yaml file which contains the tosca.nodes.nfv.example_VNF1 node type definition, this file might be included in the NSD file structure
  #- etsi_nfv_example_vnf2.yaml # uri of the yaml file which contains the tosca.nodes.nfv.example_VNF2 node type definition, this file might be included in the NSD file structure
  #- etsi_nfv_example_vnf3.yaml # uri of the yaml file which contains the tosca.nodes.nfv.example_VNF3 node type definition, this file might be included in the NSD file structure

  - example_A.14-etsi_nfv_example_vnf1.yaml  # uri of the yaml file which contains the definition of tosca.nodes.nfv.example_VNF1, this file might be included in the NSD file structure
  - example_A.14-etsi_nfv_example_vnf2.yaml  # uri of the yaml file which contains the definition of tosca.nodes.nfv.example_VNF2, this file might be included in the NSD file structure
  - example_A.14-etsi_nfv_example_vnf3.yaml  # uri of the yaml file which contains the definition of tosca.nodes.nfv.example_VNF2, this file might be included in the NSD file structure

data_types:
  MyCompany.datatypes.nfv.NsInstantiateAdditionalParameters:
    derived_from: tosca.datatypes.nfv.NsOperationAdditionalParameters

node_types:
  tosca.example_NS:
    derived_from: tosca.nodes.nfv.NS
    properties:
      descriptor_id:
        type: string
        constraints: [ equal: b1bb0ce7-ebca-4fa7-95ed-4840d70a1177 ]
        default: b1bb0ce7-ebca-4fa7-95ed-4840d70a1177
      designer:
        type: string
        constraints: [ equal: MyCompany ]
        default: MyCompany
      name:
        type: string
        constraints: [ equal: ExampleService ]
        default: ExampleService
      version:
        type: string
        constraints: [ equal: '1.0' ]
        default: '1.0'
      invariant_id:
        type: string
        constraints: [ equal: 1111-2222-aaaa-bbbb ]
        default: 1111-2222-aaaa-bbbb
      flavour_id:
        type: string
        constraints: [ equal: simple ]
        default: simple
    interfaces:
      Nslcm:
        type: tosca.interfaces.nfv.Nslcm
        operations:
          instantiate:
            inputs:
              additional_parameters:
                type: MyCompany.datatypes.nfv.NsInstantiateAdditionalParameters
    requirements:
      - virtual_link:
#       capability: tosca.capabilitites.nfv.VirtualLinkable # ERROR: indentation and typo!
          capability: tosca.capabilities.nfv.VirtualLinkable
#       occurrences: [ 0, 0 ] # ERROR: indentation!
          occurrences: [ 0, 0 ]
      - virtual_link_2:
#       capability: tosca.capabilitites.nfv.VirtualLinkable # ERROR: indentation and typo!
          capability: tosca.capabilities.nfv.VirtualLinkable
#       occurrences: [ 0, 1 ] # ERROR: indentation!
          occurrences: [ 0, 1 ]
      - virtual_link_3:
#       capability: tosca.capabilitites.nfv.VirtualLinkable # ERROR: indentation and typo!
          capability: tosca.capabilities.nfv.VirtualLinkable
#       occurrences: [ 0, 1 ]
          occurrences: [ 0, 1 ] # ERROR: indentation!
      - virtual_link_4:
#       capability: tosca.capabilitites.nfv.VirtualLinkable # ERROR: indentation and typo!
          capability: tosca.capabilities.nfv.VirtualLinkable
#       occurrences: [ 0, 1 ] # ERROR: indentation!
          occurrences: [ 0, 1 ]

topology_template:
  substitution_mappings:
    node_type: tosca.example_NS
    requirements:
      virtual_link_2: [ VNF_1_forward_2, virtual_link ] # the requirement of SAP_1
      virtual_link_3: [ VNF_3_forward_6, virtual_link ] # the requirement of SAP_2
      virtual_link_4: [ VNF_2_forward_4, virtual_link ] # the requirement of SAP_3

  node_templates:
    my_service:
      type: tosca.example_NS
      properties:
        descriptor_id: b1bb0ce7-ebca-4fa7-95ed-4840d70a1177
        designer: MyCompany
        name: ExampleService
        # . . .
      interfaces:
        Nslcm:
          operations:
            instantiate:
              implementation: instantiate.workflow.yaml
            terminate:
              implementation: terminate.workflow.yaml

    NsVirtualLink_1:
      type: tosca.nodes.nfv.NsVirtualLink
      properties:
        # . . .
        # ERROR: following properties required!
        vl_profile:
          min_bitrate_requirements:
            root: 100000
          max_bitrate_requirements:
            root: 200000
        connectivity_type:
          layer_protocols: [ ipv4 ]

    VNF_1:
      type: tosca.nodes.nfv.example_VNF1
      properties:
        descriptor_id: b1bb0ce7-2222-4fa7-95ed-4840d70a1179
        descriptor_version: "1.0.0"
        # . . .
      requirements:
        - virtual_link: VNF_1_forward_1
        - virtual_link_2: VNF_1_forward_2

    VNF_1_forward_1:
      type: tosca.nodes.nfv.Forwarding
      requirements:
        - virtual_link: NsVirtualLink_1

    VNF_1_forward_2:
      type: tosca.nodes.nfv.Forwarding
      requirements:
        - virtual_link: NsVirtualLink_1


    VNF_2:
      type: tosca.nodes.nfv.example_VNF2
      properties:
        descriptor_id: b1bb0ce7-2222-4fa7-95ed-4840d70a1182
        descriptor_version: "1.0.0"
        # . . .
      requirements:
        - virtual_link: VNF_2_forward_3
        - virtual_link_4: VNF_2_forward_4
    VNF_2_forward_3:
      type: tosca.nodes.nfv.Forwarding
# map to virtual_link requirement of the NS node

    VNF_2_forward_4:
      type: tosca.nodes.nfv.Forwarding
      requirements:
        - virtual_link: NsVirtualLink_1


    VNF_3:
      type: tosca.nodes.nfv.example_VNF3
      properties:
        descriptor_id: b1bb0ce7-2222-4fa7-95ed-4840d70a1177
        descriptor_version: "1.0.0"
        # . . .
      requirements:
        - virtual_link: VNF_3_forward_5
        - virtual_link_3: VNF_3_forward_6

    VNF_3_forward_5:
      type: tosca.nodes.nfv.Forwarding
      requirements:
        - virtual_link: NsVirtualLink_1

    VNF_3_forward_6:
      type: tosca.nodes.nfv.Forwarding


# NfpPositionElement (Service Function) for VNF_1
    Element_1:
      type: tosca.nodes.nfv.NfpPositionElement
      requirements:
        - profile_element:
            node: VNF_1_forward_1
            capability: forwarding
        - profile_element:
#           node: VNF_1_ forward_2 # ERROR: space unexpected!
            node: VNF_1_forward_2
            capability: forwarding

# NfpPositionElement (Service Function) for VNF_2
    Element_2:
      type: tosca.nodes.nfv.NfpPositionElement
      requirements:
        - profile_element:
#           node: VNF_2_ forward_3 # ERROR: space unexpected!
            node: VNF_2_forward_3
            capability: forwarding
        - profile_element:
#           node: VNF_2_ forward_4 # ERROR: space unexpected!
            node: VNF_2_forward_4
            capability: forwarding

# NfpPositionElement (Service Function) for VNF_3
    Element_3:
      type: tosca.nodes.nfv.NfpPositionElement
      requirements:
        - profile_element:
            node: VNF_3_forward_5
            capability: forwarding
        - profile_element:
            node: VNF_3_forward_6
            capability: forwarding

# NfpPosition_1 with Element_1  and Element_2 as constituents
    NfpPosition_1:
      type: tosca.nodes.nfv.NfpPosition
      properties:
        forwarding_behaviour: lb
      requirements:
          - element: Element_1
          - element: Element_2

# NfpPosition_2 with Element_3 as constituents
    NfpPosition_2:
      type: tosca.nodes.nfv.NfpPosition
      properties:
        forwarding_behaviour: all
      requirements:
          - element: Element_3

    Nfp_1:
      type: tosca.nodes.nfv.NFP
      requirements:
        - nfp_position: NfpPosition_1
        - nfp_position: NfpPosition_2

  policies:
     - NfpRule_1:
         type: tosca.policies.nfv.NfpRule
         properties:
           ether_destination_address: 00:0a:95:9d:68:16
           ether_source_address: 00:A0:C9:14:C8:29
           ether_type: ipv4
           vlan_tag:
               - "10" # ERROR: string expected!
               - "20"  # ERROR: string expected!
               - "30"  # ERROR: string expected!
           protocol: tcp
           dscp: "101111" # ERROR: string expected!
           source_port_range: [ 5000, 15000 ]
           destination_port_range: [ 800, 8080 ]
           source_ip_address_prefix: 10.10.10.0
           destination_ip_address_prefix: 125.1.12.111
           extended_criteria:
             - starting_point: 3
               length: 4 #moved left
               value: "1000"  #moved left  # ERROR: string expected!
         targets: [ Nfp_1 ]

  groups:
    VNFFG_1:
      type: tosca.groups.nfv.VNFFG
      properties:
        description: VNF Forwarding Graph for example_NS
      members: [ Nfp_1, VNF_1, VNF_2, VNF_3, NsVirtualLink_1, Element_1, Element_2, Element_3 ]
