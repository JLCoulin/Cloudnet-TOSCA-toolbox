# A.8-01.yaml
tosca_definitions_version: tosca_simple_yaml_1_3

description: Relational database, simple

imports:
  - etsi_nfv_sol001_nsd_types.yaml  # all of NSD related TOSCA types as defined in ETSI GSÂ NFV-SOL 001
 ### - example_VNF1.yaml  # uri of the yaml file which contains the definition of tosca.nodes.nfv.example_VNF1, this file might be included in the NSD file structure
 ### - example_VNF2.yaml  # uri of the yaml file which contains the definition of tosca.nodes.nfv.example_VNF2, this file might be included in the NSD file structure
  - example_A.14-etsi_nfv_example_vnf1.yaml  # uri of the yaml file which contains the definition of tosca.nodes.nfv.example_VNF1, this file might be included in the NSD file structure
  - example_A.14-etsi_nfv_example_vnf2.yaml  # uri of the yaml file which contains the definition of tosca.nodes.nfv.example_VNF2, this file might be included in the NSD file structure


data_types:
  MyCompany.datatypes.nfv.NsInstantiateAdditionalParameters:
    derived_from: tosca.datatypes.nfv.NsOperationAdditionalParameters
    properties:
      parameter_1:
        type: string
        required: true
        default: value_1
      parameter_2:
        type: string
        required: true
        default: value_2

node_types:
  tosca.example_NS:
    derived_from: tosca.nodes.nfv.NS
    properties:
      descriptor_id:
        type: string
        constraints: [ equal: b1bb0ce7-ebca-4fa7-95ed-4840d70a1177 ]
        default: b1bb0ce7-ebca-4fa7-95ed-4840d70a1177
      designer:
        type: string
        constraints: [ equal: MyCompany ]
        default: MyCompany
      name:
        type: string
        constraints: [ equal: ExampleService ]
        default: ExampleService
      version:
        type: string
        constraints: [ equal: '1.0' ]
        default: '1.0'
      invariant_id:
        type: string
        constraints: [ equal: 1111-2222-aaaa-bbbb ]
        default: 1111-2222-aaaa-bbbb
      flavour_id: 
        type: string
        constraints: [ equal: simple ]
        default: simple
    interfaces: ###moved left
        Nslcm:
          type: tosca.interfaces.nfv.Nslcm
          operations:
            instantiate:
              inputs:
                additional_parameters:
                  type: MyCompany.datatypes.nfv.NsInstantiateAdditionalParameters

    
topology_template:
  substitution_mappings:
    node_type: tosca.example_NS
    requirements:
       virtual_link: [ VNF_2, virtual_link_2 ] # the External connection point of 
                                                # VNF_2 is exposed as the Sap

  node_templates:
    my_service:
      type: tosca.example_NS
      properties:
        descriptor_id: b1bb0ce7-ebca-4fa7-95ed-4840d70a1177
        designer: MyCompany
        name: ExampleService
        version: '1.0'
        invariant_id: 1111-2222-aaaa-bbbb
        flavour_id: simple
      interfaces:
        Nslcm: 
          operations:
            instantiate:
              implementation: instantiate.workflow.yaml
            terminate:
              implementation: terminate.workflow.yaml

    VNF_1:
      type: tosca.nodes.nfv.example_VNF1
      properties:
        # no property assignments needed for required properties that have a default value assigned in the node type definition, e.g. descriptor_id
        flavour_id: simple
        vnf_profile:
          instantiation_level: level_1
          min_number_of_instances: 2
          max_number_of_instances: 6
      requirements:
        - virtual_link: NsVirtualLink_1
    
    VNF_2:
      type: tosca.nodes.nfv.example_VNF2
      properties:
        flavour_id: simple
        vnf_profile:
          instantiation_level: level_1
          min_number_of_instances: 1
          max_number_of_instances: 3
      requirements:
        - virtual_link_1: NsVirtualLink_1
        # - virtual_link_2: # map to virtual_link requirement of the NS node
        - dependency: VNF_1

    NsVirtualLink_1:
      type: tosca.nodes.nfv.NsVirtualLink
      properties:
        connectivity_type:
          layer_protocols: [ipv4]
          flow_pattern: mesh
        vl_profile:
          max_bitrate_requirements:
             root: 1000
          min_bitrate_requirements:    
             root: 1000

  policies:
   - my_service_NsMonitoring:
        type: tosca.policies.nfv.NsMonitoring
        properties:
          ns_monitoring_parameters:
           ns_monitoring_1111: #key map to the id of this monitoring parameter
             name: MyService_byte_incoming_sap
             performance_metric: byte_incoming_sap
             collection_period: 1 s
           ns_monitoring_2222: #key map to the id of this monitoring parameter
             name: MyService_byte_outgoing_sap
             performance_metric: byte_outgoing_sap
             collection_period: 1 s
        targets: [ my_service ]

   - VNF_1_VnfMonitoring:
        type: tosca.policies.nfv.VnfMonitoring
        properties:
          vnf_monitoring_parameters:
           vnf_1_monitoring_1111: #key map to the id of this monitoring parameter
             name: VNF_1_v_cpu_usage_mean_vnf
             performance_metric: v_cpu_usage_mean_vnf
             collection_period: 1 s
           vnf_1_monitoring_2222: #key map to the id of this monitoring parameter
             name: VNF_1_v_disk_usage_mean_vnf
             performance_metric: v_disk_usage_mean_vnf
             collection_period: 1 s
        targets: [ VNF_1 ]

   - VNF_2_VnfMonitoring:
        type: tosca.policies.nfv.VnfMonitoring
        properties:
          vnf_monitoring_parameters:
           vnf_2_monitoring_1111: #key map to the id of this monitoring parameter
             name: VNF_2_v_cpu_usage_mean_vnf
             performance_metric: v_cpu_usage_mean_vnf
             collection_period: 1 s
           vnf_2_monitoring_2222: #key map to the id of this monitoring parameter
             name: VNF_2_v_disk_usage_mean_vnf
             performance_metric: v_disk_usage_mean_vnf
             collection_period: 1 s
           vnf_2_monitoring_3333: #key map to the id of this monitoring parameter
             name: VNF_2_v_memory_usage_mean_vnf
             performance_metric: v_memory_usage_mean_vnf
             collection_period: 1 s
        targets: [ VNF_2 ]


